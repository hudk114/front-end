# å­—ç¬¦ç¼–ç 
æ­¤æ–‡ç”±äºŽå·¥ä½œä¸­æœ‹å‹é‡åˆ°emojiè¡¨æƒ…çš„é—®é¢˜ï¼Œæ‰€ä»¥æ€»ç»“ä¸€ä¸‹

é¦–å…ˆï¼Œunicodeæ˜¯ä¸€ä¸ªå­—ç¬¦é›†ï¼Œutf-8ï¼Œutf-16ï¼Œutf-32éƒ½æ˜¯ç¼–ç æ–¹å¼

# unicode
unicodeä¸ºæ¯ä¸ªç¬¦å·åˆ¶å®šäº†ä¸€ä¸ªç ç‚¹ï¼Œä»¥u+XXXXè¡¨ç¤ºã€‚unicodeçš„å®šä¹‰æ–¹å¼æ˜¯åˆ†åŒºå®šä¹‰ï¼Œæ¯ä¸ªåŒºå­˜æ”¾2^16ä¸ªå­—ç¬¦ï¼ˆ16ä½ï¼Œu+XXXXè¡¨ç¤ºï¼‰ï¼Œæ€»å…±æœ‰17ä¸ªå¹³é¢ï¼Œåˆ†ä¸ºåŸºç¡€å¹³é¢ï¼ˆBMPï¼‰å’Œ16ä¸ªè¾…åŠ©å¹³é¢ï¼ˆSMPï¼‰

## åŸºç¡€å¹³é¢
åŸºç¡€å¹³é¢çš„ç ç‚¹èŒƒå›´æ˜¯u+0000ï½žu+FFFFï¼Œæ˜¾ç„¶ï¼Œå¯ä»¥ç”¨16ä½æ¥å­˜å‚¨ï¼Œå› æ­¤å¯ç›´æŽ¥é‡‡ç”¨utf-16å­˜å‚¨

## è¾…åŠ©å¹³é¢
è¾…åŠ©å¹³é¢çš„ç ç‚¹èŒƒå›´æ˜¯u+010000ï½žu+10FFFFï¼Œéœ€è¦24ä½æ¥å­˜å‚¨ï¼Œç›´æŽ¥ç”¨utf-16æ— æ³•å­˜æ”¾ï¼Œç”¨utf-32åˆè¿‡äºŽæµªè´¹ï¼Œå› æ­¤é‡‡ç”¨ä¸€ç§å¯å˜é•¿åº¦çš„utf-16æ–¹å¼æ¥ç¼–ç 

# å˜é•¿çš„utf-16ç¼–ç 
è®¡ç®—æœºå­˜å‚¨çš„åªä¼šæ˜¯2å­—èŠ‚ï¼ˆ16ä½ï¼‰æˆ–4å­—èŠ‚ï¼ˆ32ä½ï¼‰ï¼Œå› æ­¤å˜é•¿çš„utf-16ç¼–ç çš„ç¼–ç æ–¹å¼æ˜¯å¯¹äºŽBMPé‡‡ç”¨16ä½ï¼Œå¯¹SMPé‡‡ç”¨32ä½

ä¸ºäº†åœ¨è§£ç æ—¶ç¡®å®šåˆ°åº•æ˜¯BMPè¿˜æ˜¯SMPå­—ç¬¦ï¼ŒBMPä¸­çš„u+D800ï½žu+DFFFä½œä¸ºç©ºæ®µæ¥æ˜ å°„è¾…åŠ©å¹³é¢ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œåªè¦è§£ç æ—¶é‡åˆ°u+D800ï½žu+DFFFçš„å­—æ®µï¼Œå°±è®¤ä¸ºæ˜¯ä¸€ä¸ª4å­—èŠ‚çš„ç¼–ç ï¼Œç”¨æ¥æ˜ å°„åˆ°SMP

å¯ä»¥è®¡ç®—ä¸€ä¸‹ï¼ŒSMPçš„å­—ç¬¦æ•°æ˜¯ `16*2^16 = 2^20` ä¸ªï¼Œè€Œu+D800ï½žu+DFFFåªæœ‰ `8*2^8=2^11` ä¸ªï¼Œå¾ˆæ˜¾ç„¶ï¼Œç›´æŽ¥æ˜ å°„è¡¨ç¤ºä¸å¤Ÿã€‚æ‰€ä»¥ï¼Œutf-16é‡‡ç”¨äº†å¤§å°ä½çš„æ–¹å¼ï¼Œå‰16ä½é«˜ä½æ˜ å°„u+D800~u+DBFFï¼ŒåŽ16ä½ä½Žä½æ˜ å°„u+DC00~u+DFFFï¼Œä¸¤è€…ç›¸ä¹˜ï¼Œå¯ä»¥è¡¨ç¤ºçš„èŒƒå›´å°±æ‰“åˆ°äº† `4*2^8*4*2^8=2^20` ä¸ªï¼ŒäºŽæ˜¯å°±å¯ä»¥å’ŒSMPç›¸å¯¹åº”äº†

_è¿™ç§æ–¹å¼è¿˜å¯ä»¥åˆ¤æ–­ç¼–ç æ˜¯å¦æ­£ç¡®ï¼Œå¯ä»¥ç”¨åœ¨ç¼–ç è‡ªæ ¡éªŒä¸­_

# jsçš„UCS-2ç¼–ç 
UCS-2æ˜¯UTF-16æœªå‡ºçŽ°å‰çš„ä¸€ä¸ªæ ‡å‡†ï¼ŒUTF-16æ˜¯UCS-2çš„è¶…é›†ï¼ŒUCS-2é‡‡ç”¨2å­—èŠ‚ç¼–ç 

jsä¸­çš„å­—ç¬¦å‡½æ•°ä¼šå°†å­—ç¬¦å½“æˆ2ä½ï¼Œæ‰€ä»¥å¯¹äºŽ4å­—èŠ‚å­—ç¬¦ï¼ˆæ¯”å¦‚emojiï¼‰ä¼šæ— æ³•å¾—åˆ°æ­£ç¡®çš„ç»“æžœ

``` javascript
'ðŒ†'.length // 2
'ðŒ†'.charCodeAt(0) // è¿”å›ž0-65536çš„codeç¼–ç  55348 
'ðŒ†'.charAt(0) // è¿”å›žç®€å•çš„UTF-16ç¼–ç å­—ç¬¦ '(ä¹±ç )'
```
å…¼å®¹å¯é‡‡ç”¨ä¸¤ç§æ–¹å¼ï¼Œ[ç¬¬ä¸€ç§](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/String/charAt)æ˜¯æ‰‹åŠ¨åˆ¤æ–­æ˜¯å¦æ˜¯SMPå­—ç¬¦ï¼›ç¬¬äºŒç§æ˜¯é‡‡ç”¨es6çš„æ–°æ–¹æ³•

``` javascript
// judge
function myCharCodeAt (str, index = 0) {
  let code = str.charCodeAt(index);
  
  if (code >= 0xDC00 && code <=0xDFFF) {
    throw new Error('ç¼–ç æœ‰è¯¯');
  }

  if (code >= 0xD800 && code <=0xDBFF) {
    let high = code;
    let low = str.charCodeAt(index + 1);
    
    if (isNaN(Number(low))) {
      throw new Error('ç¼–ç æœ‰è¯¯');
    }

    return ((hi - 0xD800) * 0x400) + (low - 0xDC00) + 0x10000; // è¿”å›žutf-16ç¼–ç 
  }

  return code;
}

// es6
for (let s of str) { ... } // éåŽ†
Array.from(str).length // èŽ·å–é•¿åº¦
'ðŒ†' === '\u{1D306}' // 4å­—èŠ‚unicodeéœ€è¦æ”¾åˆ°å¤§æ‹¬å·ä¸­
'ðŒ†'.codePointAt(0) // 119558
/^.$/u.test('ðŒ†')  // true æ­£åˆ™é‡‡ç”¨ /pattern/u æ¥æ”¯æŒ4ç ç‚¹
```

# å‚è€ƒ
1. [Unicodeä¸ŽJavaScriptè¯¦è§£](http://www.ruanyifeng.com/blog/2014/12/unicode.html)
1. [JavaScript has a Unicode problem](https://mathiasbynens.be/notes/javascript-unicode)
1. [Javascriptæœ‰ä¸ªUnicodeçš„å¤©å‘](http://www.alloyteam.com/2016/12/javascript-has-a-unicode-sinkhole/)